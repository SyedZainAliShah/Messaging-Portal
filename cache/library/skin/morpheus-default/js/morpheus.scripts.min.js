(function(c){if((typeof qtip!=="object"&&typeof moment!=="object"&&typeof portal!=="object")||typeof moment==="undefined"){return}moment.locale(portal.locale);portal.socialBullhorn=$PBJQ("#Mrphs-social-bullhorn");portal.academicBullhorn=$PBJQ("#Mrphs-academic-bullhorn");var b=function(e){var d=moment(e);return d.format("L LT")};portal.wrapNoAlertsString=function(d){return'<div class="portal-bullhorn-no-alerts">'+d+"</div>"};portal.clearBullhornAlert=function(e,f,d){$PBJQ.get("/direct/portal/clearBullhornAlert",{id:f}).done(function(){var g=$PBJQ("#portal-bullhorn-alert-"+f);var i=$PBJQ(".portal-bullhorn-"+e+"-alert").length===1;g.remove();if(i){$PBJQ(".portal-bullhorn-"+e+"-alerts").html(portal.wrapNoAlertsString(d))}var h=$PBJQ(".portal-bullhorn-"+e+"-alert").length;portal.setCounter(e,h)})};portal.clearAllAlerts=function(e,d){$PBJQ.ajax({url:"/direct/portal/clearAll"+e+"Alerts",cache:false}).done(function(){$PBJQ(".portal-bullhorn-"+e.toLowerCase()+"-alerts").html(portal.wrapNoAlertsString(d));portal.setCounter(e.toLowerCase(),0)})};portal.acceptFriendRequest=function(f,e,d,g){confirmFriendRequest(e,f);this.clearBullhornAlert(portal.SOCIAL,d,g)};portal.ignoreFriendRequest=function(g,e,d,f){ignoreFriendRequest(e,g);this.clearBullhornAlert(portal.SOCIAL,d,f)};$PBJQ(document).ready(function(){portal.socialBullhorn.qtip({suppress:false,position:{adjust:{scroll:false},my:"top right",at:"bottom left",target:portal.socialBullhorn},show:{event:"click",delay:0,solo:portal.academicBullhorn},style:{classes:"portal-bullhorns"},hide:{event:"click unfocus"},content:{text:function(e,d){return $PBJQ.ajax({url:"/direct/portal/socialAlerts.json",cache:false,}).then(function(g){if(g.message&&g.message==="NO_ALERTS"){return portal.wrapNoAlertsString(g.i18n.noAlerts)}else{var f='<div class="portal-bullhorn-social-alerts">';g.alerts.forEach(function(i){if(i.event==="profile.friend.request"){f+='<a href="javascript:;" class="portal-bullhorn-connectionmanager-pending">'}else{if(i.event==="profile.friend.confirm"){f+='<a href="javascript:;" class="portal-bullhorn-connectionmanager-current">'}else{f+='<a href="'+i.url+'">'}}f+='<div id="portal-bullhorn-alert-'+i.id+'" class="portal-bullhorn-social-alert"><div class="portal-bullhorn-photo" style="background-image:url(/direct/profile/'+i.from+'/image/thumb)"></div><div class="portal-bullhorn-content"><div class="portal-bullhorn-message"><span class="portal-bullhorn-display-name">'+i.fromDisplayName+"</span>";if(i.event==="profile.wall.item.new"){f+=g.i18n.wallPost}else{if(i.event==="profile.status.update"){f+=g.i18n.statusUpdate}else{if(i.event==="profile.wall.item.comment.new"){f+=g.i18n.postComment}else{if(i.event==="profile.friend.request"){f+=g.i18n.friendRequest}else{if(i.event==="profile.friend.confirm"){f+=g.i18n.friendConfirm}else{if(i.event==="profile.message.sent"){f+=g.i18n.message}else{if(i.event==="commons.comment.created"){f+=g.i18n.commentCreated}else{f+=g.i18n.unrecognisedAlert}}}}}}}var h=b(i.eventDate);f+='</div><div class="portal-bullhorn-time">'+h+'</div><div class="portal-bullhorn-options">';if(i.event==="profile.friend.request"){f+='<a href="javascript:;" onclick="portal.acceptFriendRequest(\''+i.from+"','"+i.to+"','"+i.id+"','"+g.i18n.noAlerts+"');\">"+g.i18n.accept+"</a>";f+='<a href="javascript:;" onclick="portal.ignoreFriendRequest(\''+i.from+"','"+i.to+"','"+i.id+"','"+g.i18n.noAlerts+"');\">"+g.i18n.ignore+"</a>"}f+="</div>";f+='</div><div class="portal-bullhorn-clear"><a href="javascript:;" onclick="portal.clearBullhornAlert(\'social\', \''+i.id+"','"+g.i18n.noAlerts+'\');" title="'+g.i18n.clear+'"><i class="fa fa-times" aria-hidden="true"></i></a></div></div></a>'});f+='<div id="portal-bullhorn-clear-all"><a href="javascript:;" onclick="portal.clearAllAlerts(\'Social\',\''+g.i18n.noAlerts+"');\">"+g.i18n.clearAll+"</a></div>";f+="</div>";return f}},function(h,f,g){d.set("content.text",f+": "+g)})}},events:{visible:function(e,d){$PBJQ(".portal-bullhorn-connectionmanager-pending").click(function(f){portal.connectionManager.show({state:"pending"});d.hide()});$PBJQ(".portal-bullhorn-connectionmanager-current").click(function(f){portal.connectionManager.show();d.hide()})}}});portal.academicBullhorn.qtip({suppress:false,position:{adjust:{scroll:false},my:"top right",at:"bottom left",target:portal.socialBullhorn},show:{event:"click",delay:0,solo:portal.socialBullhorn},style:{classes:"portal-bullhorns"},hide:{event:"click unfocus"},content:{text:function(e,d){return $PBJQ.ajax({url:"/direct/portal/academicAlerts.json",dataType:"json",cache:false,}).then(function(g){if(g.message&&g.message==="NO_ALERTS"){return portal.wrapNoAlertsString(g.i18n.noAlerts)}else{var f='<div class="portal-bullhorn-academic-alerts">';g.alerts.forEach(function(m){var l=m.title;var h=m.siteTitle;var k="fa-bullhorn";if(m.event==="asn.new.assignment"||m.event==="asn.grade.submission"){k="fa-file-text"}else{if(m.event==="lessonbuilder.comment.create"){k="fa-leanpub"}}f+='<a href="'+m.url+'" style="text-decoration: none;"><div id="portal-bullhorn-alert-'+m.id+'" class="portal-bullhorn-academic-alert"><div class="portal-bullhorn-icon fa fa-stack"><i class="fa fa-circle fa-stack-2x"></i><i class="fa '+k+' fa-stack-1x fa-inverse"></i></div><div class="portal-bullhorn-content"><div class="portal-bullhorn-message"><span class="portal-bullhorn-display-name">'+m.fromDisplayName+"</span>";var i="";if(m.event==="annc.new"){i=g.i18n.announcement.replace("{0}",l).replace("{1}",h)}else{if(m.event==="asn.new.assignment"){i=g.i18n.assignmentCreated.replace("{0}",l).replace("{1}",h)}else{if(m.event==="asn.grade.submission"){i=g.i18n.assignmentSubmissionGraded.replace("{0}",l).replace("{1}",h)}else{if(m.event==="commons.comment.created"){f+=g.i18n.academicCommentCreated.replace("{0}",h)}else{if(m.event==="lessonbuilder.comment.create"){f+=g.i18n.academicLessonBuilderCommentCreate.replace("{0}",h)}else{f+=g.i18n.unrecognisedAlert}}}}}var j=b(m.eventDate);f+=i+'</div><div class="portal-bullhorn-time">'+j+"</div>";f+='</div><div class="portal-bullhorn-clear"><a href="javascript:;" onclick="portal.clearBullhornAlert(\'academic\', \''+m.id+"','"+g.i18n.noAlerts+'\');" title="'+g.i18n.clear+'"><i class="fa fa-times" aria-hidden="true"></i></a></div></div></a>'});f+='<div id="portal-bullhorn-clear-all"><a href="javascript:;" onclick="portal.clearAllAlerts(\'Academic\',\''+g.i18n.noAlerts+"');\">"+g.i18n.clearAll+"</a></div>";f+="</div>";return f}},function(h,f,g){d.set("content.text",f+": "+g)})}}})});portal.setCounter=function(d,e){var g=$PBJQ("#Mrphs-"+d+"-bullhorn");var f=(d==="social")?"blue":"red";g.find(".bullhorn-counter").remove();g.append('<span class="bullhorn-counter bullhorn-counter-'+f+'">'+e+"</span>")};var a=function(){$PBJQ.ajax({url:"/direct/portal/bullhornCounts.json",cache:false,data:{auto:true}}).done(function(d){portal.failedBullhornCounts=0;if(d.academic>0){portal.setCounter("academic",d.academic)}else{portal.academicBullhorn.find(".bullhorn-counter").remove()}if(d.social>0){portal.setCounter("social",d.social)}else{portal.socialBullhorn.find(".bullhorn-counter").remove()}}).fail(function(f,d,e){console.log("Failed to get the bullhorn counts. Status: "+d);console.log("FAILED ERROR: "+e);portal.failedBullhornCounts=portal.failedBullhornCounts||0;portal.failedBullhornCounts+=1;if(portal.failedBullhornCounts==3){clearInterval(portal.bullhornCountIntervalId)}})};if(portal.loggedIn&&portal.bullhorns&&portal.bullhorns.enabled){a();portal.bullhornCountIntervalId=setInterval(a,portal.bullhorns.pollInterval)}})($PBJQ);$PBJQ("#footerAppPresence").on("click",function(){$PBJQ("#presenceArea").toggleClass("is-hidden")});(function(i){portal.connectionManager=portal.connectionManager||{};var n=Handlebars.templates["connection-manager-connection"];var b=Handlebars.templates["connection-manager-searchresult"];var j={};var g={};var f=function(){return Object.keys(g).length};var e={};var c={};$PBJQ(document).ready(function(){portal.i18n.loadProperties({resourceClass:"org.sakaiproject.portal.api.PortalService",resourceBundle:"connection-manager",namespace:"connection-manager",callback:function(){portal.i18n.loadProperties({resourceClass:"org.sakaiproject.portal.api.PortalService",resourceBundle:"profile-popup",namespace:"connection-manager"})}})});var l=0;var h=[];var k="connections";var o="searchresults";var a=k;var m=0;var d="";portal.connectionManager.show=function(v){var L=$PBJQ("#connection-manager");L.modal({width:320});var J=$PBJQ("#connection-manager-connectionsview");var w=$PBJQ("#connection-manager-searchresultsview");var t=$PBJQ("#connection-manager-searchresultsview-count");var O=$PBJQ("#connection-manager-navbar-current > span > a");var D=$PBJQ("#connection-manager-navbar-pending > span > a");var T=function(X){if(X===0){t.html(portal.i18n.tr("connection-manager","connection_manager_no_results"))}else{var W={count:X,criteria:portal.connectionManager.searchCriteria};var Y=(X>1)?portal.i18n.tr("connection-manager","connection_manager_results_count",W):portal.i18n.tr("connection-manager","connection_manager_result_count",W);t.html(Y)}};var q=function(){M.hide();P.show();J.show();w.hide();O.parent().addClass("current");D.parent().removeClass("current")};var N=function(){P.hide();M.show();J.show();w.hide();D.parent().addClass("current");O.parent().removeClass("current")};var s=function(Z,W){var aa=f();$PBJQ("#connection-manager-connection-"+Z).remove();$PBJQ("#connection-manager-connectionsview-searchresult-"+Z).remove();if(G.children().length===0){C.hide()}var Y=e[Z];Y.connected=false;Y.hideConnect=true;Y.outgoing=true;g[Z]=Y;var X=n(Y);if(aa===0){K.show().html("");V.hide()}K.append(X);A();if(a===k||(a==o&&x.children().length===0)){N()}$PBJQ("#connection-manager-cancel-button-"+Z).click(I)};O.click(function(W){q()});D.click(function(W){N()});var C=$PBJQ("#connection-manager-connectionsview-searchresults-wrapper");var G=$PBJQ("#connection-manager-connectionsview-searchresults");var x=$PBJQ("#connection-manager-searchresultsview-results");L.click(function(Y){if(Y.target.id!=="connection-manager-connectionsview-searchbox"){var X=C[0].getBoundingClientRect();var W=z[0].getBoundingClientRect();if(Y.pageX<X.left||Y.pageY<X.top||Y.pageX>(X.left+X.width)||Y.pageY>(X.top+X.height)){C.hide()}}});var B=$PBJQ("#connection-manager-current-connections");var P=$PBJQ("#connection-manager-current-connections-wrapper");var p=$PBJQ("#connection-manager-no-current-connections-wrapper");var K=$PBJQ("#connection-manager-pending-connections");var M=$PBJQ("#connection-manager-pending-connections-wrapper");var V=$PBJQ("#connection-manager-no-pending-connections-wrapper");var z=$PBJQ("#connection-manager-connectionsview-searchbox");z.clearSearch({callback:function(){C.hide()}});var U=$PBJQ("#connection-manager-searchresultsview-searchbox");if(m==0){d=D.html();m+=1}var S=function(Y){$PBJQ("#connection-manager-connection-"+Y).remove();if(l==0){B.html("")}var X=g[Y];X.outgoing=false;X.incoming=false;X.connected=true;var W=n(X);B.append(W);l+=1;$PBJQ("#connection-manager-remove-button-"+Y).click(Q);p.hide();delete g[Y];j[Y]=X;A();q()};var r=function(){var X=this.dataset.userId;var W=this.dataset.displayName;$PBJQ.ajax("/direct/profile/"+portal.user.id+"/confirmFriendRequest?friendId="+X,{cache:false}).done(function(Y){S(X)}).fail(function(Y,aa,Z){console.log("ERROR: failed to confirm request from '"+W+"'. errorThrown: "+Z)})};var F=function(W){$PBJQ(".connection-manager-connection-"+W).remove();delete g[W];A()};var y=function(){var X=this.dataset.userId;var W=this.dataset.displayName;$PBJQ.ajax("/direct/profile/"+portal.user.id+"/ignoreFriendRequest?friendId="+X,{cache:false}).done(function(Y){F(X)}).fail(function(Y,aa,Z){console.log("ERROR: failed to ignore request from '"+W+"'. errorThrown: "+Z)})};var E=function(){var X=this.dataset.userId;var W=this.dataset.displayName;$PBJQ.ajax("/direct/profile/"+portal.user.id+"/requestFriend?friendId="+X,{cache:false}).done(function(Y){s(X,W)}).fail(function(Y,aa,Z){console.log("ERROR: failed to request connection to '"+W+"'. errorThrown: "+Z)})};var R=function(W){$PBJQ("#connection-manager-connection-"+W).remove();l-=1;if(l==0){p.show()}delete j[W]};var Q=function(){var X=this.dataset.userId;var W=this.dataset.displayName;if(confirm(portal.i18n.tr("connection-manager","connection_manager_remove_confirm",{displayName:W}))){$PBJQ.ajax("/direct/profile/"+portal.user.id+"/removeFriend?friendId="+X,{cache:false}).done(function(Y){R(X)}).fail(function(Y,aa,Z){console.log("ERROR: failed to remove '"+W+"'. errorThrown: "+Z)})}};var I=function(){var X=this.dataset.userId;var W=this.dataset.displayName;$PBJQ.ajax("/direct/profile/"+X+"/ignoreFriendRequest?friendId="+portal.user.id,{cache:false}).done(function(Y){$PBJQ(".connection-manager-connection-"+X).remove();delete g[X];A()}).fail(function(Y,aa,Z){console.log("ERROR: failed to ignore request from '"+W+"'. errorThrown: "+Z)})};var A=function(){var W=f();if(W===0){D.html(d);K.html("").hide();V.show()}else{D.html(d+" ("+W+")")}};var H=function(Z,X){var W=(X)?x:G;if(Z.length<4){W.html("");if(!X){C.hide()}else{T(0)}return}portal.connectionManager.searchCriteria=Z;var Y=(X)?n:b;$PBJQ.ajax("/direct/portal/connectionsearch.json?query="+Z,{cache:false}).done(function(ab){W.html("");if(ab.length===0){if(!X){C.hide()}return}if(!X){C.show()}var aa="";c=ab;e={};c.forEach(function(ac){e[ac.uuid]=ac});if(X){c.forEach(function(ac,ad){aa+=Y(ac)})}else{c.slice(0,5).forEach(function(ac,ad){aa+=Y(ac)})}if(X){T(c.length)}W.html(aa);if(W.children().length>0){W.show()}$PBJQ(document).ready(function(){if(!X){profile.attachPopups($PBJQ(".profile-popup"),{connect:s,cancel:F,accept:S,ignore:F,remove:R})}else{$PBJQ(".connection-manager-connect-button").click(E)}$PBJQ("#connection-manager-connectionsview-searchresults-more").click(function(ac){a=o;G.html("");C.hide();J.hide();w.show();U.val(portal.connectionManager.searchCriteria);z.val("");$PBJQ(document).ready(function(){T(c.length);var ad="";c.forEach(function(ae,af){ae.facebookSet=ae.socialNetworkingInfo.facebookUrl;ae.twitterSet=ae.socialNetworkingInfo.twitterUrl;ae.moreResult=true;if(j.hasOwnProperty(ae.uuid)){ae.connected=true;ae.hideConnect=true}if(g.hasOwnProperty(ae.uuid)){ae.connected=false;ae.hideConnect=true;ae.outgoing=g[ae.uuid].outgoing;ae.incoming=g[ae.uuid].incoming}ad+=n(ae)});x.html(ad);$PBJQ(document).ready(function(){$PBJQ(".connection-manager-accept-button").click(r);$PBJQ(".connection-manager-ignore-button").click(y);$PBJQ(".connection-manager-connect-button").click(E);$PBJQ(".connection-manager-remove-button").click(Q);$PBJQ(".connection-manager-cancel-button").click(I)})})});$PBJQ("#connection-manager-backtoconnections-link").click(function(ac){a=k;w.hide();J.show();C.hide();G.html("");z.val("")})})})};$PBJQ.ajax("/direct/profile/"+portal.user.id+"/connections.json",{cache:false}).done(function(W){j={};l=W.length;searchUserIdFilter=[portal.user.id];B.html("");h=W;if(h.length==0){p.show()}else{p.hide()}W.forEach(function(X){X.facebookSet=X.socialNetworkingInfo.facebookUrl;X.twitterSet=X.socialNetworkingInfo.twitterUrl;X.current=true;X.connected=true;X.incoming=false;X.hideConnect=true;j[X.uuid]=X;B.append(n(X))});$PBJQ(document).ready(function(){$PBJQ(".connection-manager-remove-button").click(Q)})}).fail(function(W,Y,X){console.log("ERROR: failed to get current connections. errorThrown: "+X)});var u=function(W){if(W.length==0){V.show();K.hide()}else{V.hide();K.show().html("")}W.forEach(function(X){X.hideConnect=true;X.pending=true;K.append(n(X));g[X.uuid]=X});if(W.length>0){D.html(d+" ("+W.length+")")}else{D.html(d)}$PBJQ(document).ready(function(){$PBJQ(".connection-manager-accept-button").click(r);$PBJQ(".connection-manager-ignore-button").click(y);$PBJQ(".connection-manager-cancel-button").click(I)})};$PBJQ.ajax("/direct/profile/"+portal.user.id+"/incomingConnectionRequests.json",{cache:false}).done(function(W){g={};W.forEach(function(X){X.incoming=true});$PBJQ.ajax("/direct/profile/"+portal.user.id+"/outgoingConnectionRequests.json",{cache:false}).done(function(X){X.forEach(function(Y){Y.outgoing=true;W.push(Y)});u(W)}).fail(function(X,Z,Y){console.log("Failed to get outgoing requests. errorThrown: "+Y)})}).fail(function(W,Y,X){console.log("Failed to get incoming requests. errorThrown: "+X)});z.keyup(function(W){H(this.value,false)});z.keydown(function(W){if(W.which==13&&this.value.length>=4){$PBJQ("#connection-manager-connectionsview-searchresults-more").click()}});U.keyup(function(W){H(this.value,true)});if(v&&v.state==="pending"){N()}};$PBJQ("#Mrphs-userNav__submenuitem--connections").click(portal.connectionManager.show)})($PBJQ);$PBJQ(function(){var f=$PBJQ("#toolMenu");var d=$PBJQ("#content");if(d.length==1){var e=f.height();if($PBJQ(document.body).height()<$PBJQ(window).height()){var b=$PBJQ("#footer").outerHeight();var a=d.offset().top;var c=$PBJQ(window).height()-a-b;e=Math.max(e,c)}d.css("minHeight",e+"px")}});$PBJQ("details").details();$PBJQ(document).ready(function(){updateFooterTime=(function(){if($PBJQ("#preferredTime").length==1){var c=$PBJQ("#preferredTime").data("preferredtzdisplay");var e=new Date(parseInt($PBJQ("#preferredTime").data("preferredserverdateandgmtoffset")));var a=e.getTime()-(new Date()).getTime()}var b=$PBJQ("#serverTime").data("servertzdisplay");var d=new Date(parseInt($PBJQ("#serverTime").data("serverdateandgmtoffset")));var f=d.getTime()-(new Date()).getTime();return function(){var g=new Date((new Date()).getTime()+f);var h=g.toUTCString().replace(/GMT/,b).replace(/UTC/,b);$PBJQ("#serverTime").text(h);if($PBJQ("#preferredTime").length==1){var g=new Date((new Date()).getTime()+a);var h=g.toUTCString().replace(/GMT/,c).replace(/UTC/,c);$PBJQ("#preferredTime").text(h)}setTimeout("updateFooterTime()",1000)}})();if($PBJQ("#serverTime").length==1){updateFooterTime()}});(function(a){portal.i18n=portal.i18n||{};portal.i18n.translations=portal.i18n.translations||{};portal.i18n.loadProperties=function(b){if(!b.resourceClass||!b.resourceBundle||!b.namespace){console.log("You must supply a resourceClass, a resourceBundle and a namespace. Doing nothing ...");return}if(b.debug){console.log("resourceClass: "+b.resourceClass);console.log("resourceBundle: "+b.resourceBundle);console.log("namespace: "+b.namespace)}portal.i18n.translations[b.namespace]=portal.i18n.translations[b.namespace]||{};$PBJQ.ajax({url:"/sakai-ws/rest/i18n/getI18nProperties",cache:true,dataType:"text",data:{locale:portal.locale,resourceclass:b.resourceClass,resourcebundle:b.resourceBundle},}).done(function(d,e,c){d.split("\n").forEach(function(g){var f=g.split("=");if(f.length==2){portal.i18n.translations[b.namespace][f[0]]=f[1]}if(b.debug){console.log("Updated translations: ");console.log(portal.i18n.translations[b.namespace])}});if(b.callback){b.callback()}}).fail(function(c,e,d){console.log(d)})};portal.i18n.tr=function(e,d,c){if(!e||!d){console.log("You must supply a namespace and a key.");return}var b=portal.i18n.translations[e][d];if(!b){console.log(e+"#key "+d+" not found. Returning key ...");return d}if(c!=undefined){for(var f in c){b=b.replace("{"+f+"}",c[f])}}return b};Handlebars.registerHelper("tr",function(d,c,b){return new Handlebars.SafeString(portal.i18n.tr(d,c,b.hash))})})($PBJQ);$PBJQ(document).ready(function(){var a={dragModeStartMsg:"drag start, Use U and D keys to move the item up and down",dragModeEndMsg:"Drag end",newPositionMsg:"Moved to position %s"};$PBJQ.widget("sakai.keyboardSortable",$PBJQ.ui.sortable,{options:{keyboardHandle:false},_create:function(){this._super();this.options.keyboardHandle=this.options.keyboardHandle||this.options.items;this._dragging=false;this.element.on("keydown",this.options.keyboardHandle,$PBJQ.proxy(this._keydown,this));this.liveRegion=$PBJQ("<div class='ui-helper-hidden-accessible'></div>").liveregion().appendTo(document.body);this.element.find(this.options.keyboardHandle).attr({"aria-grabbed":"false","data-at-shortcutkeys":'{"u":"drag item up","d":"drag item down"}'}).blur($PBJQ.proxy(function(c){var b=$PBJQ(c.target);if(this._isDragging()){this._toggleDragMode(b,this._closestSortableNode(b))}},this)).click($PBJQ.proxy(function(c){if(c.clientX<=0||c.clientX===undefined){var b=$PBJQ(c.target);this._toggleDragMode(b,this._closestSortableNode(b))}},this))},_keydown:function(d){if($PBJQ.inArray(d.which,[27,38,40,68,85])===-1){return}if($PBJQ(d.target).is(":input")){return}d.preventDefault();var b=$PBJQ(d.target);var c=this._closestSortableNode(b);switch(d.which){case 27:if(this._isDragging()){this._toggleDragMode(b,c)}break;case 38:case 85:if(d.ctrlKey||this._isDragging()||d.which===85){this._moveBackward(c,b)}break;case 40:case 68:if(d.ctrlKey||this._isDragging()||d.which===68){this._moveForward(c,b)}break}},_closestSortableNode:function(b){var c=b.parentsUntil(this.element).last();if(!c.length){c=b}return c},_isDragging:function(){return this._dragging},_toggleDragMode:function(b,c){var d=this._isDragging();c.toggleClass("sakai-dragging",!d);if(!d){this.element.find(this.options.keyboardHandle).attr("aria-grabbed","false");this._dragging=true;b.attr("aria-grabbed","true");this._notify(a.dragModeStartMsg)}else{b.attr("aria-grabbed","false");this._dragging=false;this._notify(a.dragModeEndMsg)}},_moveBackward:function(c,d,b){$prevNode=c.prev(b);if(!$prevNode.length){return}$prevNode.insertAfter(c);this._highlightDrag(c);this._notifyPosition(c)},_moveForward:function(c,d,b){$nextNode=c.next(b);if(!$nextNode.length){return}$nextNode.insertBefore(c);this._highlightDrag(c);this._notifyPosition(c)},_highlightDrag:function(b){if(this._isDragging()){return}b.addClass("sakai-dragging-temp");setTimeout(function(){b.removeClass("sakai-dragging-temp")},1000)},_notifyPosition:function(b){var c=this.element.find(this.options.items).index(b)+1;this._notify(a.newPositionMsg.replace("%s",c))},_notify:function(b){this.liveRegion.liveregion("instance").notify(b);this._trigger("update")}});$PBJQ.widget("sakai.liveregion",{_create:function(){this.timeout=null},notify:function(b){setTimeout($PBJQ.proxy(function(){var c=$PBJQ("<div aria-live='polite'></div>").attr("role","status").appendTo(this.element);if(this.timeout){clearTimeout(this.timeout)}this.timeout=setTimeout($PBJQ.proxy(function(){c.text(b)},this),500);setTimeout($PBJQ.proxy(function(){this._clear(c)},this),10000)},this),0)},_clear:function(b){b.remove()}})});var selectSiteModalLinks,selectSiteLastModalInTab;var dhtml_view_sites=function(){$PBJQ("#selectSiteModal").addClass("dhtml_more_tabs");$PBJQ(".more-tab").position();var a=$PBJQ(window).height()*0.8;dhtml_view_sites=function(){var e=$PBJQ("#selectSiteModal");e.show();if(typeof selectSiteModalLinks=="undefined"||typeof selectSiteLastModalInTab=="undefined"){selectSiteModalLinks=e.find("button, a");selectSiteLastModalInTab=e.find(".tab-box a:last")}e.on("keydown",function(h){var g=false;if(h.ctrlKey||h.metaKey||h.altKey){return}switch(h.which){case 27:closeDrawer();g=true;break;case 9:if(h.shiftKey){if(h.target===selectSiteModalLinks[0]){selectSiteModalLinks[selectSiteModalLinks.length-1].focus();g=true}}else{if(h.target===selectSiteModalLinks[selectSiteModalLinks.length-1]||h.target===selectSiteLastModalInTab[selectSiteLastModalInTab.length-1]){selectSiteModalLinks[0].focus();g=true}}break}if(g){h.preventDefault()}});if(e.hasClass("outscreen")){$PBJQ("body").toggleClass("active-more-sites");var b=$PBJQ(".view-all-sites-btn:visible");var d=b.height()+5;if(b.length>0){b.css("z-index",1005);var c=b.offset().top-$PBJQ(window).scrollTop()+d;var f=$PBJQ("body").outerWidth()-(b.offset().left+b.outerWidth());if($PBJQ("html").attr("dir")!=="rtl"){e.css("top",c).css("right",f)}else{e.css("top",c).css("left",$PBJQ("body").outerWidth()-f)}}e.toggleClass("outscreen");a-=c;a-=parseInt(e.css("padding-bottom"),20);if(MorpheusViewportHelper.isNonPhone()){$PBJQ("#txtSearch").focus()}createDHTMLMask(dhtml_view_sites);$PBJQ(".selectedTab").bind("click",function(g){dhtml_view_sites();return false});$PBJQ(".tab-pane:first").focus();$PBJQ(document).trigger("view-sites-shown")}else{$PBJQ("body").toggleClass("active-more-sites");$PBJQ("#selectSiteModal").toggleClass("outscreen");var b=$PBJQ(".view-all-sites-btn");b.css("z-index","auto");$PBJQ("#selectSite").attr("tabindex","-1");removeDHTMLMask();$PBJQ("#otherSiteTools").remove();$PBJQ(".selectedTab").unbind("click")}};if($PBJQ(window).width()<800){a=a*0.85}$PBJQ(".tab-pane").css("height",a);dhtml_view_sites()};function closeDrawer(){$PBJQ("#selectSiteModal").toggleClass("outscreen");removeDHTMLMask();$PBJQ("#selectSite").attr("tabindex","-1");$PBJQ("#otherSiteTools").remove();$PBJQ(".selectedTab").unbind("click");$PBJQ(".moreSitesLink").unbind("keydown");if($PBJQ(".view-all-sites-btn a:visible").length){$PBJQ(".view-all-sites-btn a").focus()}else{$PBJQ(".js-toggle-sites-nav").focus()}}function createDHTMLMask(a){$PBJQ("body").append('<div id="portalMask">&nbsp;</div>');$PBJQ("#portalMask").css("height",browserSafeDocHeight()).css({width:"100%","z-index":1000,top:0,left:0}).attr("tabindex",-1).bind("click",function(b){a();return false});$PBJQ("#portalMask").bgiframe()}function removeDHTMLMask(){$PBJQ("#portalMask").remove()}function showToolMenu(h){var g=h.attr("id");var a=g.replace(/!/g,"\\!").replace(/~/g,"\\~");$PBJQ(".toolMenus").removeClass("toolMenusActive").attr("aria-expanded","false");if($PBJQ("."+a).length){$PBJQ("#otherSiteTools").remove()}else{var c=$PBJQ('<ul id="otherSiteTools" role="menu" />').addClass(g);var f="/direct/site/"+g+"/pages.json";scroll(0,0);var e=parseInt($PBJQ("#maxToolsInt").text());var d=$PBJQ("#maxToolsText").text();var i=$PBJQ('<li class="otherSiteTool" ><span><a role="menuitem" tabindex="-1"><span class="Mrphs-toolsNav__menuitem--icon"> </span></a></span></li>');var b=i.clone();b.addClass("gotosite");b.find("a").attr("href",portal.portalPath+"/site/"+g).attr("title",d).append(d);b.find("a span").addClass("icon-sakai--see-all-tools");$PBJQ.getJSON(f,function(j){$PBJQ.each(j,function(l,m){if(!m.tools[0]){return true}if(l<e){var k=i.clone();k.find("a").attr("href",m.tools[0].url).attr("title",m.title).append(m.title);k.find("a span").addClass("icon-sakai--"+m.tools[0].toolId.replace(/\./gi,"-")).addClass("otherSiteToolIcon");if(m.toolpopup){k.find("a").attr("href",m.tools[0].url+"?sakai.popup=yes").attr("onclick","window.open("+m.toolpopupurl+"); return false")}c.append(k)}});if(j.length>e){c.append(b.clone())}$PBJQ("#otherSiteTools").remove();h.closest("li").append(c);h.closest("li").find("ul li a").first().focus();addArrowNavAndDisableTabNav($PBJQ("ul#otherSiteTools"));h.parent().find(".toolMenus").addClass("toolMenusActive").attr("aria-expanded","true")})}}$PBJQ(document).ready(function(){if($PBJQ("#eid").length===1){$PBJQ("#eid").focus()}$PBJQ(".js-toggle-sites-nav","#skipNav").on("click",dhtml_view_sites);$PBJQ("#show-all-sites, .view-all-sites-btn").on("click",dhtml_view_sites);var b=portal.siteTitle;if(b){if(portal.shortDescription){b=b+" ("+portal.shortDescription+")"}$PBJQ(".portletTitle h2").prepend('<span class="siteTitle">'+b+":</span> ")}$PBJQ("#txtSearch").keyup(function(d){if(d.keyCode==27){a()}if($PBJQ("#txtSearch").val().length>0){var e=$PBJQ("#txtSearch").val().toLowerCase();$PBJQ(".fav-sites-term, .fav-sites-entry").hide();var c=$PBJQ(".fav-sites-entry").filter(function(f,g){return($PBJQ(".fav-title a span.fullTitle",g).text().toLowerCase().indexOf(e)>=0)});c.show();c.closest(".fav-sites-term").show()}if($PBJQ("#txtSearch").val().length==0){a()}if($PBJQ("#otherSiteList li:visible").length<1&&$PBJQ(".otherSitesCategorList li:visible").length<1){$PBJQ(".norecords").remove();$PBJQ("#noSearchResults").fadeIn("slow")}});function a(){$PBJQ("#txtSearch").val("");$PBJQ(".fav-sites-term, .fav-sites-entry").show();$PBJQ("#noSearchResults").hide();$PBJQ("#txtSearch").focus()}$PBJQ("#otherSiteSearchClear").on("click",function(){a()});$PBJQ("#presenceToggle").click(function(c){c.preventDefault();$PBJQ("#presenceArea").toggle()});$PBJQ(".trayPopupClose").click(function(c){c.preventDefault();$PBJQ(this).closest(".trayPopup").hide()});if($PBJQ("a.tool-directurl").length){$PBJQ("a.tool-directurl").cluetip({local:true,arrows:true,cluetipClass:"jtip",sticky:true,cursor:"pointer",activation:"click",closePosition:"title",closeText:'<img src="/library/image/silk/cross.png" alt="close">'})}});$PBJQ(document).ready(function(e){var n=true;var v=undefined;var z=[];var g=$PBJQ("#max-favorite-entries").text().trim();var x=false;var l=$PBJQ("#selectSite");var r=$PBJQ("#otherSitesCategorWrap");var m=$PBJQ("#organizeFavorites");var o={};$PBJQ(".site-favorite-btn",r).each(function(A,B){o[$PBJQ(B).data("site-id")]=$PBJQ(B).parent()});var b={favorite:{markup:'<i class="site-favorite-icon site-favorite"></i>'},nonfavorite:{markup:'<i class="site-favorite-icon site-nonfavorite"></i>'},myworkspace:{markup:'<i class="site-favorite-icon site-workspace site-favorite"></i>'}};var d=function(A){$PBJQ.ajax({url:"/portal/favorites/list",method:"GET",dataType:"json",success:function(B){n=B.autoFavoritesEnabled;z=B.favoriteSiteIds.filter(function(D,C){return D!=""});if(v==undefined){v=z}A(z)}})};var p=function(A,C){var B=b[C];$PBJQ(A).data("favorite-state",C);if(C==="favorite"){$PBJQ(A).attr("title",$PBJQ("#removeFromFavoritesText").text().replace("[site]",$PBJQ(A).parent().find("span.fullTitle").text()))}else{if(C==="nonfavorite"){$PBJQ(A).attr("title",$PBJQ("#addToFavoritesText").text().replace("[site]",$PBJQ(A).parent().find("span.fullTitle").text()))}else{$PBJQ(A).attr("title",null)}}$PBJQ(A).empty().append($PBJQ(B.markup))};var f=function(){var A=$PBJQ(".fav-sites-entry .site-favorite",r).length;$PBJQ(".favoriteCount",l).text("("+A+")");if(A>g){$PBJQ(".favoriteCountAndWarning").addClass("maxFavoritesReached")}else{$PBJQ(".favoriteCountAndWarning").removeClass("maxFavoritesReached")}};var i=function(){$PBJQ(".favorites-select-all-none",r).each(function(A,C){var E=$PBJQ(C).closest(".fav-sites-term");var B=E.find(".fav-sites-entry:not(.my-workspace)").length;var D=E.find(".fav-sites-entry .site-favorite").length;if(B==0){$PBJQ(C).hide()}else{if(D==B){$PBJQ(C).data("favorite-state","favorite");$PBJQ(C).html(b.favorite.markup)}else{$PBJQ(C).data("favorite-state","nonfavorite");$PBJQ(C).html(b.nonfavorite.markup)}$PBJQ(C).show()}})};var s=function(){$PBJQ(".site-favorite-btn",r).empty();$PBJQ(".favorites-select-all-none",r).empty()};var k=function(A){$PBJQ(".site-favorite-btn",r).each(function(B,C){var D=$PBJQ(C).data("site-id");if($PBJQ(C).closest(".my-workspace").length>0){p(C,"myworkspace")}else{if($PBJQ.inArray(D,A)>=0){p(C,"favorite")}else{p(C,"nonfavorite")}}});$PBJQ(".favorites-help-text").hide();if(n){$PBJQ(".favorites-help-text.autofavorite-enabled").show()}else{$PBJQ(".favorites-help-text.autofavorite-disabled").show()}i();f();x=true};var w=function(){return $PBJQ(".site-favorite-btn",r).has(".site-favorite").map(function(){return $PBJQ(this).data("site-id")}).toArray()};var h=function(A){if(q){x=false;s()}if(!A){A=0}if(q&&A<100){setTimeout(function(){h(A+1)},50)}else{d(k)}};var y=function(B,A){if(B.length!=A.length){return false}for(var C=0;C<B.length;C++){if(B[C]!=A[C]){return false}}return true};var j=function(){if(y(z,v)){$PBJQ(".moresites-refresh-notification").remove();return}if($PBJQ(".moresites-refresh-notification").length>0){return}var A=$PBJQ('<div class="moresites-refresh-notification" />').html($PBJQ("#refreshNotificationText").html());$PBJQ("#loginLinks").prepend(A);A.css("top",($PBJQ(".Mrphs-siteHierarchy").offset().top)+"px")};var q=false;var u=[];var t=function(A){var B;while(u.length>0){B=u.shift()}if(B){$PBJQ.ajax({url:"/portal/favorites/update",method:"POST",data:{userFavorites:JSON.stringify(B),},error:A,complete:t})}else{q=false}};var a=function(B){if(!x){return}if(!B){B=function(){}}var A=w();A=A.sort(function(E,D){if(z.indexOf(E)===-1){return 1}else{if(z.indexOf(D)===-1){return -1}else{return z.indexOf(E)-z.indexOf(D)}}});var C={favoriteSiteIds:A,autoFavoritesEnabled:n,};u.push(C);if(q){}else{q=true;t(B)}z=A;j()};var c=function(E){if(v&&v.indexOf(E)>-1){var A=v.indexOf(E);var C=false;for(var F=A-1;F>=0;F--){var D=v[F];var B=z.indexOf(D);if(B>=0&&B<A){z.splice(B+1,0,E);C=true;break}}if(!C){z.splice(A,0,E)}}};$PBJQ(r).on("click",".site-favorite-btn",function(){var B=this;var D=$PBJQ(B).data("site-id");var A=$PBJQ(B).data("favorite-state");if(A==="myworkspace"){return}var C;if(A==="favorite"){C="nonfavorite"}else{C="favorite"}if(C=="favorite"){c(D)}p(B,C);i();f();a(function(){h()})});$PBJQ(r).on("click",".favorites-select-all-none",function(){var B=$PBJQ(this).data("favorite-state");var A=$PBJQ(this).closest(".fav-sites-term").find(".fav-sites-entry:not(.my-workspace) .site-favorite-btn");var C;if(B=="favorite"){C="nonfavorite"}else{C="favorite"}A.each(function(D,E){p($PBJQ(E),C)});f();i();a(function(){h()})});$PBJQ(l).on("click",".tab-btn",function(){$PBJQ(".tab-btn",l).removeClass("active").attr("aria-selected","false").attr("tabindex","-1");$PBJQ(this).addClass("active").attr("aria-selected","true").attr("tabindex","0");var A=$PBJQ(this).data("tab-target");$PBJQ(".tab-box").hide();$PBJQ(l).trigger("tab-shown",A);$PBJQ("#"+A).show()});$PBJQ(l).on("keydown",".tab-btn",function(A){if(A.keyCode==32){$PBJQ(this).click();A.preventDefault()}if(A.keyCode==37){$PBJQ("[aria-selected=true]").prev().click().focus();A.preventDefault()}if(A.keyCode==38){$PBJQ("[aria-selected=true]").prev().click().focus();A.preventDefault()}if(A.keyCode==39){$PBJQ("[aria-selected=true]").next().click().focus();A.preventDefault()}if(A.keyCode==40){$PBJQ("[aria-selected=true]").next().click().focus();A.preventDefault()}});$PBJQ(document).on("view-sites-shown",function(){h()});$PBJQ(l).on("tab-shown",function(D,A){if(A==="organizeFavorites"){var C=$PBJQ("#organizeFavoritesList");C.empty();$PBJQ("#noFavoritesToShow").hide();$PBJQ("#favoritesToShow").hide();$PBJQ("#otherSiteTools").remove();$PBJQ("#organizeFavoritesPurgatoryList").empty();$PBJQ.each(z,function(F,H){if(!o[H]){return}if($PBJQ(o[H]).hasClass("my-workspace")){return}var G=o[H].clone(false);G.addClass("organize-favorite-item").data("site-id",H);var E=$PBJQ('<a href="javascript:void(0);" class="fav-drag-handle"><i class="fa fa-bars"></i></a>');$PBJQ(".toolMenus",G).remove();G.append(E);C.append(G);G.show()});if(C.find("li").length==0){$PBJQ("#noFavoritesToShow").show()}else{$PBJQ("#favoritesToShow").show()}var B=function(){var E=$PBJQ(".organize-favorite-item");E.removeClass("site-favorite-is-past-max");$PBJQ(".favorites-max-marker").remove();$PBJQ.each(E,function(G,F){if(G>=g){$PBJQ(F).addClass("site-favorite-is-past-max")}if(G==g){$PBJQ(F).before($PBJQ('<li class="favorites-max-marker"><i class="fa fa-warning warning-icon"></i> '+$PBJQ("#maxFavoritesLimitReachedText").text()+"</li>"))}})};B();C.keyboardSortable({items:"li:not(.favorites-max-marker)",handle:".fav-drag-handle",update:function(){B();z=C.find(".organize-favorite-item").map(function(){return $PBJQ(this).data("site-id")}).toArray();a()}});C.disableSelection();$PBJQ("#autoFavoritesEnabled").attr("aria-checked",n);$PBJQ("#organizeFavorites .onoffswitch").show()}});$PBJQ(r).on("click",".toolMenus",function(A){A.preventDefault();showToolMenu($PBJQ(this));return false});$PBJQ(m).on("click",".site-favorite-btn",function(){var C=this;if($PBJQ(C).closest(".my-workspace").length>0){return}var A=$PBJQ(C).parent();var B;if($PBJQ(C).closest("#organizeFavoritesList").length==0){var E=$PBJQ(C).data("site-id");c(E);var D=z.indexOf(E);if(D==0){$PBJQ("#organizeFavoritesList").prepend(A)}else{if(D>0){$PBJQ("#organizeFavoritesList li:nth-child("+D+")").after(A)}else{$PBJQ("#organizeFavoritesList").append(A)}}B="favorite"}else{$PBJQ("#organizeFavoritesPurgatoryList").append(A);B="nonfavorite"}p(C,B);p(o[$PBJQ(C).data("site-id")].find(".site-favorite-btn"),B);i();f();a(function(){h()})});$PBJQ("#autoFavoritesEnabled").click(function(){$PBJQ(this).attr("aria-checked",function(A,B){var C=(B==="true");return String(!C)});$PBJQ(this).trigger("change")});$PBJQ("#autoFavoritesEnabled").on("change",function(){n=$PBJQ(this).attr("aria-checked")==="true";$PBJQ(".favorites-help-text").hide();if(n){$PBJQ(".favorites-help-text.autofavorite-enabled").show()}else{$PBJQ(".favorites-help-text.autofavorite-disabled").show()}a();return true});$PBJQ(".otherSitesMenuClose").on("click",function(){dhtml_view_sites()})});var profile=profile||{};profile.requestFriend=function(b,a,c){$PBJQ.ajax({url:"/direct/profile/"+b+"/requestFriend?friendId="+a,dataType:"text",cache:false}).done(function(e,f,d){$PBJQ("#profile-popup-request-button-"+a).hide();$PBJQ("#profile-popup-cancel-button-"+a).show();if(c){c(a)}});return false};profile.confirmFriendRequest=function(b,a,c){$PBJQ.ajax({url:"/direct/profile/"+b+"/confirmFriendRequest?friendId="+a,dataType:"text",cache:false}).done(function(e,f,d){$PBJQ("#profile-popup-incoming-block-"+a).hide();$PBJQ("#profile-popup-remove-button-"+a).show();if(c){c(a)}});return false};profile.removeFriend=function(a,c,d,b){$PBJQ.ajax({url:"/direct/profile/"+a+"/removeFriend?friendId="+c,dataType:"text",cache:false}).done(function(f,g,e){$PBJQ("#profile-popup-remove-button-"+c).hide();$PBJQ("#profile-popup-request-button-"+c).show();if(d&&b){d(c,b)}});return false};profile.ignoreFriendRequest=function(a,b,c,d){$PBJQ.ajax({url:"/direct/profile/"+a+"/ignoreFriendRequest?friendId="+b,cache:false}).done(function(f,g,e){if(c!==undefined&&c==true){$PBJQ("#profile-popup-cancel-button-"+a).hide();$PBJQ("#profile-popup-request-button-"+a).show();if(d){d(a)}}else{$PBJQ("#profile-popup-incoming-block-"+b).hide();$PBJQ("#profile-popup-request-button-"+b).show();if(d){d(b)}}});return false};profile.attachPopups=function(b,a){if(!(b instanceof $PBJQ)){console.log("profile.attachPopups takes a jQuery object array, from a selector");return}b.each(function(){var d=this.dataset.userId;var e=this.dataset.displayName;var c=$PBJQ(this).find(".profile-popup-target");var f=(c.length>0)?c.eq(0):$PBJQ(this);$PBJQ(this).qtip({position:{target:f,my:"top left",at:"bottom center",viewport:$PBJQ(window),adjust:{method:"flipinvert none"}},show:{event:"click",delay:0},style:{classes:"profile-popup-qtip qtip-shadow"},hide:{event:"click unfocus"},content:{text:function(h,g){return $PBJQ.ajax({url:"/direct/portal/"+d+"/formatted",cache:false}).then(function(i){return i},function(k,i,j){g.set("content.text",i+": "+j)})}},events:{visible:function(k,i){var g=$PBJQ("#profile-popup-request-button-"+d);g.on("click",function(n){profile.requestFriend(portal.user.id,d)});var l=$PBJQ("#profile-popup-cancel-button-"+d);l.on("click",function(n){profile.ignoreFriendRequest(d,portal.user.id,true)});var h=$PBJQ("#profile-popup-accept-button-"+d);h.on("click",function(n){profile.confirmFriendRequest(portal.user.id,d)});var m=$PBJQ("#profile-popup-ignore-button-"+d);m.on("click",function(n){profile.ignoreFriendRequest(portal.user.id,d,false)});var j=$PBJQ("#profile-popup-remove-button-"+d);j.on("click",function(n){profile.removeFriend(portal.user.id,d)});if(a){if(a.connect){g.off("click").on("click",function(n){var o=function(p){a.connect(p);i.destroy()};profile.requestFriend(portal.user.id,d,o)})}if(a.cancel){l.off("click").on("click",function(n){var o=function(p){a.cancel(p);i.destroy()};profile.ignoreFriendRequest(d,portal.user.id,true,o)})}if(a.accept){h.off("click").on("click",function(n){var o=function(p){a.accept(p);i.destroy()};profile.confirmFriendRequest(portal.user.id,d,o)})}if(a.ignore){m.off("click").on("click",function(n){var o=function(p){a.ignore(p);i.destroy()};profile.ignoreFriendRequest(portal.user.id,d,false,o)})}if(a.remove){j.off("click").on("click",function(n){var o=function(q,p){a.remove(q,p);i.destroy()};profile.removeFriend(portal.user.id,d,o,e)})}}}}})})};function publishSite(b){var a="/direct/site/"+b+"/edit";var c=$PBJQ.ajax({type:"POST",data:"published=true",url:a,success:function(){location.reload()}}).responseText};function quickLinksNavEscHandler(a){if(a.keyCode===27){toggleQuickLinksNav(a)}}function toggleQuickLinksNav(b){b.preventDefault();if(!$PBJQ(".Mrphs-userNav__subnav").hasClass("is-hidden")){toggleUserNav(b)}$PBJQ(".Mrphs-quickLinksNav__subnav").toggleClass("is-hidden");if(!$PBJQ(".Mrphs-quickLinksNav__subnav").hasClass("is-hidden")){var a=$PBJQ('<div class="quicklinks-dropdown-overlay" />');a.on("click",function(c){toggleQuickLinksNav(c)});$PBJQ("body").prepend(a);$PBJQ("body").css("overflow-y","hidden");$PBJQ(document).on("keyup",quickLinksNavEscHandler);$PBJQ(".tab-box").css("max-height",window.innerHeight-$PBJQ("#selectQuickLink").offset().top-14)}else{$PBJQ(".quicklinks-dropdown-overlay").remove();$PBJQ("body").css("overflow-y","visible");$PBJQ(document).off("keyup",quickLinksNavEscHandler)}}$PBJQ("#quickLinks-close").on("click",toggleQuickLinksNav);$PBJQ(".js-toggle-quick-links-nav").on("click",toggleQuickLinksNav);$PBJQ(document).ready(function(){if($PBJQ("#reorder-list li").size()-1>15){$PBJQ(".grabHandle").show();$PBJQ("#inputFieldMessage").show();$PBJQ("#inputKbdMessage").remove()}$PBJQ("#reorder-list li").each(function(a){$PBJQ("#lastMoveArrayInit").append($PBJQ(this).attr("id")+" ");$PBJQ("#lastMoveArray").append($PBJQ(this).attr("id")+" ")});$PBJQ('input[id^="index"]').click(function(a){a.stopPropagation()});$PBJQ('input[id^="index"]').bind("keypress",function(b){var a=b.charCode||b.keyCode;return(a==13)?false:true});$PBJQ("#undo-all").click(function(a){var b;b=$PBJQ.trim($PBJQ("#lastMoveArrayInit").text()).split(" ");for(z in b){thisRow=document.getElementById(b[z]);$PBJQ(thisRow).appendTo("#reorder-list")}a.preventDefault();registerChange();$PBJQ("#undo-all").hide();$PBJQ("#undo-all-inact").show();$PBJQ("#undo-last-inact").show();$PBJQ("#undo-last").hide()});$PBJQ("#undo-last").click(function(d){var c;var a;var b;c=$PBJQ.trim($PBJQ("#lastMoveArray").text()).split(" ");for(z in c){thisRow=document.getElementById(c[z]);$PBJQ(thisRow).appendTo("#reorder-list")}a=$PBJQ.trim($PBJQ("#lastItemMoved").text());b=$PBJQ("li:eq("+a.substr(20)+")");$PBJQ(b).addClass("recentMove");d.preventDefault();registerChange("notfluid",b);$PBJQ("#undo-last-inact").fadeIn("slow");$PBJQ("#undo-last").hide()});$PBJQ('input[id^="index"]').change(function(){var f=this;preserveStatus();var d=parseInt($PBJQ(this).siblings('input[id^="holder"]').attr("value"));var e=parseInt(this.value);if(isNaN(e)||e>$PBJQ('input[id^="index"]').size()){var b=$PBJQ("#failedValidMessage").text();$PBJQ("#messageHolder").text(b.replace("#",$PBJQ('input[id^="index"]').size()));$PBJQ(".orderable-selected").removeClass("orderable-selected");$PBJQ("#messageHolder").removeClass("messageSuccess");$PBJQ("#messageHolder").addClass("messageValidation");var a=$PBJQ(f).position();$PBJQ("#messageHolder").css({position:"absolute",height:"1.3em",top:a.top,left:55});$PBJQ("#messageHolder").fadeIn("slow");$PBJQ("#messageHolder").animate({opacity:1},2000,function(){$PBJQ(f).val(d);f.focus();f.select()});$PBJQ("#messageHolder").fadeOut("slow");$PBJQ(this).parents("li").addClass("orderable-selected");return(null)}var c=$PBJQ('input[id^="index"]');$PBJQ("#undo-last").fadeIn("slow");$PBJQ("#undo-last-inact").hide();$PBJQ("#undo-all").fadeIn("slow");$PBJQ("#undo-all-inact").hide();if(e==="1"){$PBJQ($PBJQ(this).parents("li")).insertBefore($PBJQ(this).parents("li").siblings("li").children("span").children("input[value="+e+"]").parents("li"))}else{if(e==c.length){$PBJQ($PBJQ(this).parents("li")).insertAfter($PBJQ(this).parents("li").siblings("li").children("span").children("input[value="+e+"]").parents("li"))}else{if(e>d){$PBJQ($PBJQ(this).parents("li")).insertAfter($PBJQ(this).parents("li").siblings("li").children("span").children("input[value="+e+"]").parents("li"))}else{$PBJQ($PBJQ(this).parents("li")).insertBefore($PBJQ(this).parents("li").siblings("li").children("span").children("input[value="+e+"]").parents("li"))}}}registerChange("notfluid",$PBJQ(this).parents("li"))});return $PBJQ("#reorder-list").keyboardSortable({items:"li:not(.notsortable)",start:function(a,b){preserveStatus(b)},update:function(a,b){registerChange(a,b)},})});var registerChange=function(b,d){var k=$PBJQ("#reorder-list li").size();if(b!=="notfluid"){d=$PBJQ("li[aria-selected='true']")}$PBJQ("#lastItemMoved").text($PBJQ(d).attr("id"));$PBJQ(d).addClass("recentMove");var a=0;a=$PBJQ((d).prevAll("li").length+1);var f=$PBJQ('input[id^="index"]');var h=$PBJQ('input[id^="holder"]');var j=$PBJQ("select.selectSet");for(var c=0;c<f.length;c=c+1){$PBJQ(f[c]).attr("value",c+1).val(c+1)}for(var g=0;g<h.length;g=g+1){$PBJQ(h[g]).attr("value",g+1).val(g+1)}for(var e=0;e<j.length;e=e+1){$PBJQ(j[e]).val(e+1);$PBJQ(j[e]).find("option").removeAttr("selected");$PBJQ(j[e]).find("option[value="+(e+1)+"]").attr("selected","selected")}$PBJQ("#undo-last").fadeIn("slow");$PBJQ("#undo-last-inact").hide();$PBJQ("#undo-all").fadeIn("slow");$PBJQ("#undo-all-inact").hide();$PBJQ(d).animate({opacity:1},2000,function(){$PBJQ(d).removeClass("recentMove")})};var preserveStatus=function(a){$PBJQ("#lastMoveArray").text("");$PBJQ("#reorder-list li").each(function(b){if($PBJQ(this).attr("id")!==undefined&&$PBJQ(this).attr("id")!=="undefined_avatar"){$PBJQ("#lastMoveArray").append($PBJQ(this).attr("id")+" ")}})};function toggleToolsNav(a){if(a){a.preventDefault()}$PBJQ("body").toggleClass("toolsNav--displayed");if($PBJQ("body").hasClass("toolsNav--displayed")){createDHTMLMask(toggleToolsNav)}else{removeDHTMLMask()}}$PBJQ(document).ready(function(){function a(){function b(){if($PBJQ("#roleSwitchDropDown").is(".open")){$PBJQ("#roleSwitchDropDownToggle").trigger("click")}}function c(d){if(d.keyCode==27){b();return false}return true}$PBJQ("#roleSwitchDropDownToggle").attr("aria-hidden","false").attr("aria-haspopup","true");$PBJQ("#roleSwitchDropDown").attr("aria-hidden","true");$PBJQ("#roleSwitchDropDownToggle").click(function(){$PBJQ("#roleSwitchDropDown").css("right",$PBJQ(window).width()-20-($PBJQ("#roleSwitchDropDownToggle").offset().left+$PBJQ("#roleSwitchDropDownToggle").width()));$PBJQ("#roleSwitchDropDown").toggleClass("open");if($PBJQ("#roleSwitchDropDown").is(".open")){$PBJQ("#roleSwitchDropDown").attr("aria-hidden","false");$PBJQ(document.body).prepend('<div class="user-dropdown-overlay"></div>');$PBJQ(".user-dropdown-overlay").on("click",function(){b()});$PBJQ(document.body).on("keyup",c);setTimeout(function(){$PBJQ("#roleSwitchDropDown").find("a, :input").focus()})}else{$PBJQ("#roleSwitchDropDown").attr("aria-hidden","true");$PBJQ(".user-dropdown-overlay").remove();$PBJQ(document.body).off("keyup",c);$PBJQ("#roleSwitchDropDownToggle").focus()}})}$PBJQ("#roleSwitchSelect").on("change",function(){if($PBJQ("option:selected",this).text()!==""){document.location=$PBJQ("option:selected",this).val()+"#roleSwitch"}else{$PBJQ(this)[0].selectedIndex=0}});if(MorpheusViewportHelper.isPhone()){a()}else{$PBJQ("#roleSwitch").addClass("menu-not-setup")}});$PBJQ(".js-toggle-tools-nav","#skipNav").on("click",toggleToolsNav);var sessionId="current";var sessionTimeOut;var timeoutDialogEnabled=false;var timeoutDialogWarningTime;var timeoutLoggedoutUrl;var timeoutPortalPath;$PBJQ(document).ready(function(){if(portal.loggedIn&&portal.timeoutDialog){setTimeout("setup_timeout_config();",60000)}});var setup_timeout_config=function(){timeoutDialogEnabled=portal.timeoutDialog.enabled;timeoutDialogWarningTime=portal.timeoutDialog.seconds;timeoutLoggedoutUrl=portal.loggedOutUrl;timeoutPortalPath=portal.portalPath;if(timeoutDialogEnabled==true){poll_session_data();fetch_timeout_dialog()}};var poll_session_data=function(){$PBJQ.ajax({url:"/direct/session/"+sessionId+".json?auto=true&_="+(new Date()).getTime(),dataType:"json",success:function(b){b.maxInactiveInterval=b.maxInactiveInterval*1000;if(b.active&&b.userId!=null&&b.lastAccessedTime+b.maxInactiveInterval>b.currentTime){var a=b.lastAccessedTime+b.maxInactiveInterval-b.currentTime;if(a<timeoutDialogWarningTime*1000){min=Math.round(a/(1000*60));show_timeout_alert(min);clearTimeout(sessionTimeOut);sessionTimeOut=setTimeout("poll_session_data()",1000*60)}else{clearTimeout(sessionTimeOut);sessionTimeOut=setTimeout("poll_session_data()",(a-timeoutDialogWarningTime*1000))}}else{if(b.userId==null){location.href=timeoutLoggedoutUrl}else{sessionTimeOut=setTimeout("poll_session_data()",1000*10)}}},error:function(c,a,b){}})};function keep_session_alive(){dismiss_session_alert();$PBJQ.get(timeoutPortalPath)}var dismiss_session_alert=function(){removeDHTMLMask();$PBJQ("#timeout_alert_body").remove()};var timeoutDialogFragment;function fetch_timeout_dialog(){$PBJQ.ajax({url:"/portal/timeout?auto=true",cache:true,dataType:"text",success:function(a){timeoutDialogFragment=a},error:function(c,a,b){timeoutDialogEnabled=false}})}function show_timeout_alert(b){if(!timeoutDialogEnabled){return}if(!$PBJQ("#portalMask").get(0)){createDHTMLMask(dismiss_session_alert);$PBJQ("#portalMask").css("z-index",1000)}if($PBJQ("#timeout_alert_body").get(0)){$PBJQ("#timeout_alert_body span").html(b)}else{var a=timeoutDialogFragment.replace("{0}",b);$PBJQ("body").append(a)}};function toggleShortUrlOutput(b,c,a){if($PBJQ(c).is(":checked")){$PBJQ.ajax({url:"/direct/url/shorten?path="+encodeURI(b),dataType:"text",success:function(d){$PBJQ("."+a).val(d)}})}else{$PBJQ("."+a).val(b)}}$PBJQ(document).ready(function(){$PBJQ(".Mrphs-toolTitleNav__link--directurl").click(function(c){var a=$PBJQ(this).position(),b=$PBJQ(this).siblings(".Mrphs-directUrl");b.toggleClass("active").css({left:a.left+"px"});b.attr("aria-expanded","true");b.find("[tabindex]").first().focus();c.preventDefault()});$modal_container=$PBJQ(".Mrphs-directUrl");$modal_container.each(function(b){var a=$PBJQ(this).find("[tabindex]");a.first().on("keydown",function(c){if(c.keyCode===9&&c.shiftKey){a.last().focus();c.preventDefault();return false}});a.last().on("keydown",function(c){if(c.keyCode===9&&!c.shiftKey){a.first().focus();c.preventDefault();return false}})});$modal_container.last().on("keypress",function(a){if(a.keyCode()===9){console.log("keypress:: primero");$modal_container.fist().focus();a.preventDefault();return false}});$PBJQ(".Mrphs-directUrl .dropDown_close").on("click keypress",function(b){var a=$PBJQ(this).parent();a.toggleClass("active");a.removeAttr("aria-expanded");$PBJQ('.Mrphs-toolTitleNav__link--directurl[rel="#'+a.attr("id")+'"]').focus();b.preventDefault()})});var setupSkipNav=function(){$PBJQ("#skipNav a.Mrphs-skipNav__link").click(function(){var a=$PBJQ(this).attr("href");$PBJQ(a).attr("tabindex","-1").focus()})};$PBJQ(document).ready(function(){var a=0;$PBJQ(document).scroll(function(c){var b=$PBJQ(this).scrollTop();if(b>a&&b>90){$PBJQ(".Mrphs-topHeader").addClass("moving");$PBJQ(".Mrphs-siteHierarchy").addClass("moving");$PBJQ(".Mrphs-toolsNav__title--current-site").addClass("moving");$PBJQ(".Mrphs-skipNav__menu").addClass("moving");$PBJQ(".Mrphs-sitesNav__menuitem--myworkspace").addClass("moving")}else{if(b>90||b==0){$PBJQ(".Mrphs-topHeader").removeClass("moving");$PBJQ(".Mrphs-siteHierarchy").removeClass("moving");$PBJQ(".Mrphs-toolsNav__title--current-site").removeClass("moving");$PBJQ(".Mrphs-skipNav__menu").removeClass("moving");$PBJQ(".Mrphs-sitesNav__menuitem--myworkspace").removeClass("moving")}}a=b})});var closeAllDropdownMenus=function(){$PBJQ(".Mrphs-sitesNav__menuitem").removeClass("dropdown-is-visible");$PBJQ(".Mrphs-sitesNav__menuitem").find(".is-visible").removeClass("is-visible");$PBJQ(".Mrphs-sitesNav__menuitem").find(".is-clicked").removeClass("is-clicked");$PBJQ(".sitenav-dropdown-overlay").remove()};var buildDropdownMenu=function(b,a,g){var i='<ul class="Mrphs-sitesNav__submenu" role="menu">';var e=parseInt($PBJQ("#linkNav").attr("data-max-tools-int"));var d=$PBJQ("#linkNav").attr("data-max-tools-anchor");var c='<li class="Mrphs-sitesNav__submenuitem Mrphs-sitesNav__submenuitem__gotosite"><a tabindex="-1" role="menuitem" href="'+portal.portalPath+"/site/"+a+'" title="'+d+'"><span class="toolMenuIcon icon-sakai--see-all-tools"></span>'+d+"</a></li>";var f="/direct/site/"+a+"/pages.json";var h=window.location.pathname.split("/").pop();$PBJQ.ajax({url:f,dataType:"json",success:function(j){$PBJQ.each(j,function(n,o){if(!o.tools||o.tools.length<=0){return}var m="";if(h==o.tools[0].id){m=" is-current"}if(n<=e){var l;if(o.toolpopup){var k=' role="menuitem" href="{{tool_url}}?sakai.popup=yes" title="{{item_title}}" onclick="window.open(\'{{item_toolpopupurl}}\');"';l='<li class="Mrphs-sitesNav__submenuitem" ><a tabindex="-1" class="Mrphs-sitesNav__submenuitem-link"'+k+'>  <span class="Mrphs-sitesNav__submenuitem-icon"><span class="toolMenuIcon icon-sakai--{{icon}}"></span></span>  <span class="Mrphs-sitesNav__submenuitem-title">{{item_title}}</span></a></li>'}else{var k=' role="menuitem" href="{{tool_url}}" title="{{item_title}}"';l='<li class="Mrphs-sitesNav__submenuitem{{is_current}}"><a tabindex="-1" class="Mrphs-sitesNav__submenuitem-link"'+k+'>  <span class="Mrphs-sitesNav__submenuitem-icon"><span class="toolMenuIcon icon-sakai--{{icon}}"></span></span>  <span class="Mrphs-sitesNav__submenuitem-title">{{item_title}}</span></a></li>'}i+=(l.replace(/{{tool_url}}/g,o.tools[0].url).replace(/{{item_title}}/g,o.title).replace(/{{item_toolpopupurl}}/g,o.toolpopupurl).replace(/{{icon}}/g,o.tools[0].toolId.replace(/\./gi,"-")).replace(/{{is_current}}/g,m))}});if((j.length-1)>e){i+=c}i+="</ul>";i=$PBJQ(i);b.append(i);addArrowNavAndDisableTabNav(i);g(i)},error:function(l,j,k){}})};var setupSiteNav=function(){$PBJQ("ul.Mrphs-sitesNav__menu").each(function(){$PBJQ(this).keydown(function(a){if(a.keyCode==27){closeAllDropdownMenus()}})});$PBJQ(document).on("keydown",".Mrphs-sitesNav__menu > li.Mrphs-sitesNav__menuitem > a",function(a){if(a.keyCode==40){a.preventDefault();var b=$PBJQ(this).parent().find(".Mrphs-sitesNav__dropdown");if(b.data("clicked")){}else{b.data("clicked",true);b.trigger("click")}}else{if(a.keyCode==27){a.preventDefault();closeAllDropdownMenus()}}});$PBJQ("ul.Mrphs-sitesNav__menu li .Mrphs-sitesNav__dropdown").click(function(d){d.preventDefault();var g=$PBJQ(d.target);var a=g.parent(".Mrphs-sitesNav__menuitem");var f=a.hasClass("dropdown-is-visible");closeAllDropdownMenus();if(f){return}var c=$PBJQ(this);var b=function(h){c.addClass("is-clicked");a.addClass("dropdown-is-visible");h.addClass("is-visible");a.find("li a").first().focus();var e=$PBJQ('<div class="sitenav-dropdown-overlay" />');e.on("click",function(i){closeAllDropdownMenus()});$PBJQ("body").prepend(e);c.removeData("clicked")};if(!a.find("ul").length){buildDropdownMenu(a,g.attr("data-site-id"),b)}else{b(a.find("ul"))}}).hover(function(){$PBJQ(this).toggleClass("Mrphs-sitesNav__dropdown--hover")})};function addArrowNavAndDisableTabNav(a){a.find("li a").attr("tabindex","-1").keydown(function(f){var d=$PBJQ(f.target);if(f.keyCode==40){f.preventDefault();var b=d.closest("li").next();if(b.length===0||b.find("a").length==0){b=a.find("li").first()}a.find("li a").attr("tabindex","-1");b.find("a").focus().attr("tabindex","0")}else{if(f.keyCode==38){f.preventDefault();var c=d.closest("li").prev();if(c.length===0){c=a.find("a").closest("ul")}a.find("li a").attr("tabindex","-1");c.find("a").focus().attr("tabindex","0")}else{if(f.keyCode==9){closeAllDropdownMenus()}}}})};portal=portal||{};if(portal.toolsCollapsed===undefined){portal.toolsCollapsed=false}portal.updateToolsCollapsedPref=function(b){var a="/direct/userPrefs/updateKey/"+portal.user.id+"/sakai:portal:sitenav?toolsCollapsed="+b;$PBJQ.ajax(a,{method:"PUT",cache:false})};portal.toggleMinimizeNav=function(){$PBJQ("body").toggleClass("Mrphs-toolMenu-collapsed");$PBJQ("#subSites.floating").css({display:"none"});var a=$PBJQ(this);a.toggleClass("min max").parent().toggleClass("min max");if(portal.toolsCollapsed){portal.updateToolsCollapsedPref(false);portal.toolsCollapsed=false;a.attr("aria-pressed",false)}else{portal.updateToolsCollapsedPref(true);portal.toolsCollapsed=true;a.attr("aria-pressed",true)}};$PBJQ("#toolsNav-toggle-li button").on("click",portal.toggleMinimizeNav);$PBJQ(document).ready(function(){$PBJQ("#toggleSubsitesLink").click(function(d){var c=$PBJQ(this);if($PBJQ("#subSites").css("display")=="block"){$PBJQ("#subSites").hide();$PBJQ("#subSites").removeClass("floating")}else{var a=c.position();var f=(-1*($PBJQ("#toolMenu").height()-a.top));var b=(MorpheusViewportHelper.isPhone())?{display:"block",left:"-0.7rem",top:0,"margin-top":"0.3rem",overflow:"hidden"}:{display:"block",left:a.left+c.width()+6+"px",top:f+"px"};$PBJQ("#subSites").css(b);$PBJQ("#subSites").addClass("floating");if($PBJQ("#toggleSubsitesLink").position().top<240){$PBJQ("#subSites.floating").addClass("ontop")}}})});function updatePresence(){$PBJQ.ajax({url:sakaiPresenceFragment,cache:false,success:function(g){var f=g.indexOf("<ul");if(f<1){$PBJQ("#presenceCount").html(" ");$PBJQ("#presenceCount").removeClass("present").addClass("empty");location.reload();return}g=g.substr(f);var e=g;var b="<li";var a=0;for(var d=0;d<e.length;d++){if(b==e.substr(d,b.length)){a++}}if(a>1){$PBJQ("#presenceCount").html(a+"");$PBJQ("#presenceCount").removeClass("empty").addClass("present")}else{if(a==1){$PBJQ("#presenceCount").html(a+"");$PBJQ("#presenceCount").removeClass("present").addClass("empty")}else{$PBJQ("#presenceCount").html(" ");$PBJQ("#presenceCount").removeClass("present").addClass("empty")}}$PBJQ("#presenceIframe").html(g);var c=$PBJQ(".nav-selected .icon-sakai-chat").attr("href");$PBJQ("#presenceIframe .presenceList li.inChat span").wrap('<a href="'+c+'"></a>');sakaiLastPresenceTimeOut=setTimeout("updatePresence()",30000)},error:function(b,a){sakaiLastPresenceTimeOut=setTimeout("updatePresence()",60000)}})};function userNavEscHandler(a){if(a.keyCode===27){toggleUserNav(a)}}function toggleUserNav(b){b.preventDefault();$PBJQ(".Mrphs-userNav__subnav").toggleClass("is-hidden");if(!$PBJQ(".Mrphs-userNav__subnav").hasClass("is-hidden")){var a=$PBJQ('<div class="user-dropdown-overlay" />');a.on("click",function(c){toggleUserNav(c)});$PBJQ("body").prepend(a);$PBJQ(document).on("keyup",userNavEscHandler)}else{$PBJQ(".user-dropdown-overlay").remove();$PBJQ(document).off("keyup",userNavEscHandler)}}$PBJQ("#loginLink1").click(function(a){if($PBJQ(this).attr("data-warning")!==""&&!confirm($PBJQ(this).attr("data-warning"))){a.preventDefault()}});$PBJQ(".js-toggle-user-nav a#loginUser > .Mrphs-userNav__drop-btn","#loginLinks").on("click",toggleUserNav);$PBJQ(".js-toggle-user-nav .Mrphs-userNav__drop-btn","#loginLinks").on("click",toggleUserNav);$PBJQ(".Mrphs-userNav__pic-changer").on("click",function(b){var k=$PBJQ(this);if(!window.FileReader){$PBJQ(k.data("profileLink")).trigger("click");return true}if(!$PBJQ.fn.modal){$PBJQ(k.data("profileLink")).trigger("click");return true}b.preventDefault();b.stopImmediatePropagation();function i(){l.find(".modal-body .alert").hide();$PBJQ.ajax("/direct/profile-image/remove",{data:{sakai_csrf_token:sakai_csrf_token},type:"POST",dataType:"json",success:function(q,r,p){if(q.status=="SUCCESS"){g();$PBJQ("#cropToolbar").hide()}else{$PBJQ("#remove-error").show()}}})}function d(){a.find("> img").cropper({aspectRatio:1/1,checkCrossOrigin:false,guides:true,minContainerWidth:300,minContainerHeight:300,autoCropArea:1,viewMode:1,dragMode:"move"})}function e(){var p=$PBJQ("#cropToolbar").show();if(!portal.pictureToolbarSetup){$PBJQ(".profile-image-zoom-in",p).on("click",function(){a.find("> img").cropper("zoom",0.1)});$PBJQ(".profile-image-zoom-out",p).on("click",function(){a.find("> img").cropper("zoom",-0.1)});$PBJQ(".profile-image-pan-up",p).on("click",function(){a.find("> img").cropper("move",0,-10)});$PBJQ(".profile-image-pan-down",p).on("click",function(){a.find("> img").cropper("move",0,10)});$PBJQ(".profile-image-pan-left",p).on("click",function(){a.find("> img").cropper("move",10,0)});$PBJQ(".profile-image-pan-right",p).on("click",function(){a.find("> img").cropper("move",-10,0)});$PBJQ(".profile-image-rotate",p).on("click",function(){a.find("> img").cropper("clear");a.find("> img").cropper("rotate",90);a.find("> img").cropper("crop")});portal.pictureToolbarSetup=true}}function f(p){a.show();a.find("> img").cropper("clear");a.find("> img").cropper("replace",p);j.removeProp("disabled");e()}function c(){$PBJQ.getJSON("/direct/profile-image/details?_="+new Date().getTime(),function(p){if(p.status=="SUCCESS"){if(!p.isDefault){f(p.url+"?_="+new Date().getTime());$PBJQ(".remove-profile-image").on("click",function(){i()})}}sakai_csrf_token=p.csrf_token})}function n(){return new Promise(function(p){p(a.find("> img").cropper("getCroppedCanvas",{width:200,height:200}).toDataURL())})}function g(){var r=$PBJQ("#loginUser > .Mrphs-userNav__submenuitem--profilepicture");var q=r.parent();r.detach();var s=new Date();var p="background-image: url(/direct/profile/"+portal.user.id+"/image/thumb?"+s.getTime()+")";r.attr("style",p);q.prepend(r);r=$PBJQ(".Mrphs-userNav__submenuitem--profilelink > .Mrphs-userNav__submenuitem--profilepicture");q=r.parent();r.detach();r.attr("style",p);q.prepend(r);$PBJQ("#profileImageUpload").modal("hide")}function m(p){l.find(".modal-body .alert").hide();$PBJQ.ajax("/direct/profile-image/upload",{data:{sakai_csrf_token:sakai_csrf_token,base64:p},type:"POST",dataType:"json",success:function(r,s,q){if(r.status=="SUCCESS"){g()}else{$PBJQ("#upload-error").show()}}})}var l=$PBJQ("#profileImageUpload");var o=false;l.on("shown.bs.modal",function(){c()});l.modal({width:320});$PBJQ("#remove-error").hide();$PBJQ("#upload-error").hide();var j=l.find("#save");var h=$PBJQ("#file");var a=$PBJQ("#cropme").hide();d();h.on("change",function(){var q=$PBJQ(this);if(this.files&&this.files[0]){var p=new FileReader();p.onload=function(r){f(r.target.result)};p.readAsDataURL(this.files[0])}else{throw"Browser does not support FileReader"}});j.on("click",function(p){n().then(function(q){m(q.replace(/^data:image\/(png|jpg);base64,/,""))})});return false});var header=$PBJQ(".Mrphs-topHeader");var currentHeaderWidth=-1;$PBJQ(document).ready(function(){$PBJQ(header).data("sticked",false);if($PBJQ(".Mrphs-hierarchy--parent-sites").length>0&&$PBJQ(window).width()<=800){$PBJQ("#content").css("margin-top",(parseInt($PBJQ("#content").css("margin-top").replace("px",""))+$PBJQ(".Mrphs-hierarchy--parent-sites").outerHeight(true))+"px")}$PBJQ(window).resize(function(){currentHeaderWidth=$PBJQ(".Mrphs-mainHeader").width()});$PBJQ(window).scroll(function(){var b=0;var a=(($PBJQ(document).height()-$PBJQ(window).height())>$PBJQ(header).height())===true;if($PBJQ(window).scrollTop()>0){if($PBJQ(header).data("sticked")===false&&a===true){$PBJQ(header).data("sticked",true);$PBJQ(".Mrphs-mainHeader").addClass("is-fixed")}}else{$PBJQ(".Mrphs-mainHeader").removeClass("is-fixed");$PBJQ(header).data("sticked",false)}});currentHeaderWidth=$PBJQ(".Mrphs-mainHeader").width();$PBJQ(".Mrphs-headerLogo").on("click",function(){document.body.scrollTop=0;document.body.scrollLeft=0;$PBJQ(window).trigger("scroll")})});function f_scrollTop(){return f_filterResults(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)}function f_filterResults(d,b,a){var c=d?d:0;if(b&&(!c||(c>b))){c=b}return a&&(!c||(c>a))?a:c}$PBJQ(document).ready(function(){$PBJQ("input, textarea","#content").each(function(){if($PBJQ(this).prop("disabled")){$PBJQ(this).parent("label").addClass("disabled")}});$PBJQ(document).keyup(function(a){if(a.keyCode==27){if(!$PBJQ("#selectSiteModal").hasClass("outscreen")){$PBJQ("#otherSitesMenu .otherSitesMenuClose").trigger("click")}$PBJQ(".Mrphs-directUrl__dropDown").each(function(){if($PBJQ(this).hasClass("active")){$PBJQ(this).find(".dropDown_close").trigger("click")}});$PBJQ(".fip-icon-up-dir").trigger("click");$PBJQ(".navigatePanelControls .close").trigger("click")}})});var MorpheusViewportHelper={isPhone:function(){return $PBJQ("#Mrphs-viewport-helpers .phone").is(":visible")},isTablet:function(){return $PBJQ("#Mrphs-viewport-helpers .tablet").is(":visible")},isDesktop:function(){return $PBJQ("#Mrphs-viewport-helpers .desktop").is(":visible")},isNonPhone:function(){return(this.isDesktop()||this.isTablet())&&!this.isPhone()},};$PBJQ(document).ready(function(){if($PBJQ("#loginLink2").length==1){$PBJQ("#loginLink2").click(function(a){$PBJQ("body").append('<div id="Mrphs-xlogin-container" />');$PBJQ("#Mrphs-xlogin-container").load("/portal/xlogin #Mrphs-xlogin",function(){$PBJQ("#Mrphs-xlogin-container").addClass("loaded");$PBJQ("#Mrphs-xlogin").addClass("loadedByAjax");$PBJQ("#eid").focus()});$PBJQ(".Mrphs-portalWrapper").addClass("blurry");$PBJQ("body").append('<div id="loginPortalMask" />');$PBJQ("#loginPortalMask").bgiframe();$PBJQ("#loginPortalMask").click(function(){$PBJQ("#loginPortalMask").remove();$PBJQ("#Mrphs-xlogin-container").remove();$PBJQ(".Mrphs-portalWrapper").removeClass("blurry")});a.preventDefault()})}});